# 문제 해결

TALLY NODE 사용 중 발생할 수 있는 문제들과 해결 방법을 안내합니다.

## 🔌 전원 관련 문제

### 기기가 켜지지 않음
#### 증상
- OLED 디스플레이가 켜지지 않음
- LED가 점등되지 않음
- USB 연결 시에도 인식되지 않음

#### 해결 방법
1. **배터리 전압 확인**
   ```
   멀티미터로 배터리 전압 측정
   정상 범위: 3.6V ~ 4.2V
   3.0V 이하: 배터리 교체 필요
   ```

2. **전원 스위치 확인**
   - 전원 스위치가 ON 위치에 있는지 확인
   - 스위치 접촉 불량 시 여러 번 조작

3. **USB 전원 테스트**
   - 배터리 분리 후 USB만으로 전원 공급 테스트
   - 다른 USB 포트/어댑터로 테스트

### 배터리가 빨리 소모됨
#### 증상
- 정상 사용 시간보다 배터리가 빠르게 소모
- 배터리 레벨이 급격히 떨어짐

#### 해결 방법
1. **전력 소비 확인**
   - OLED 밝기 최적화
   - LoRa 전송 파워 조정 (불필요하게 높지 않게)
   - WiFi 절전 모드 활성화 (마스터)

2. **배터리 상태 점검**
   - 배터리 노후화 확인
   - 충방전 사이클 확인
   - 필요시 배터리 교체

## 📡 통신 관련 문제

### LoRa 통신이 안됨
#### 증상
- 리시버에서 마스터 신호를 받지 못함
- RSSI가 -100dBm 이하로 매우 낮음
- Tally 정보가 업데이트되지 않음

#### 해결 방법
1. **주파수 대역 확인**
   ```
   마스터와 리시버가 같은 주파수인지 확인:
   - 400MHz (433MHz 대역)
   - 900MHz (915MHz 대역)
   ```

2. **안테나 점검**
   - U.FL 커넥터 연결 상태 확인
   - 안테나 손상 여부 확인
   - 안테나가 수직으로 세워져 있는지 확인

3. **거리 및 장애물**
   - 송수신 거리를 줄여보기 (5m 이내)
   - 금속 물체나 벽 사이의 장애물 제거
   - 높은 곳에 안테나 배치

4. **전력 설정 확인**
   - LoRa 전송 파워를 최대로 설정 (22dBm)
   - 전송 간격을 줄여보기 (100ms)

### WiFi 연결 문제 (마스터)
#### 증상
- 스튜디오 WiFi에 연결되지 않음
- IP 주소를 받지 못함
- 인터넷에 접속되지 않음

#### 해결 방법
1. **네트워크 설정 확인**
   - SSID와 비밀번호 재확인
   - 2.4GHz 대역 사용 확인 (5GHz 지원 안함)
   - MAC 주소 필터링 해제

2. **신호 강도 확인**
   - WiFi 라우터와의 거리 단축
   - 다른 WiFi 네트워크로 테스트

3. **팩토리 리셋**
   - BOOT 버튼 10초간 누르기 (부팅 중)
   - 네트워크 설정 초기화

## 🖥️ 스위처 연동 문제

### ATEM 연결 실패
#### 증상
- ATEM 스위처에 연결되지 않음
- "Connection failed" 메시지
- Tally 정보가 수신되지 않음

#### 해결 방법
1. **네트워크 연결 확인**
   ```bash
   # ATEM IP로 ping 테스트
   ping 192.168.1.240
   
   # 포트 테스트 (Windows)
   telnet 192.168.1.240 9910
   ```

2. **ATEM 설정 확인**
   - ATEM Software Control에서 네트워크 설정 확인
   - 다른 클라이언트가 연결되어 있다면 해제
   - ATEM 펌웨어 버전 확인

3. **방화벽 설정**
   - 방화벽에서 포트 9910 허용
   - 네트워크 보안 정책 확인

### vMix 연결 실패
#### 증상
- vMix API에 접근할 수 없음
- HTTP 요청 시간 초과
- XML 데이터를 받지 못함

#### 해결 방법
1. **vMix Web Controller 활성화**
   - vMix Settings → Web Controller 체크
   - 포트 8099 사용 확인
   - 외부 접근 허용 설정

2. **방화벽 확인**
   - Windows 방화벽에서 vMix 허용
   - 포트 8099 인바운드 허용

## 🔧 하드웨어 문제

### OLED 디스플레이 문제
#### 증상
- 화면이 나오지 않음
- 화면이 깨져서 나옴
- 일부 영역이 안 보임

#### 해결 방법
1. **I2C 연결 확인**
   - SDA (GPIO18), SCL (GPIO17) 납땜 상태
   - 3.3V 전원 공급 확인
   - I2C 주소 충돌 확인 (0x3C)

2. **디스플레이 모듈 교체**
   - 다른 OLED 모듈로 교체 테스트
   - 연결선 교체

### LED가 안 켜짐 (리시버)
#### 증상
- WS2812B LED가 점등되지 않음
- 색상이 이상하게 나옴
- 깜빡거림 현상

#### 해결 방법
1. **전원 공급 확인**
   - 5V 전원이 LED에 공급되는지 확인
   - 전류 용량 확인 (최대 60mA)

2. **데이터 신호 확인**
   - GPIO45 신호선 연결 상태
   - 신호 레벨 확인 (3.3V)

## 🔄 펌웨어 문제

### 업로드 실패
#### 증상
- "Failed to connect" 오류
- 부트 모드 진입 실패
- 업로드 중 오류 발생

#### 해결 방법
1. **부트 모드 수동 진입**
   ```
   1. BOOT 버튼을 누른 상태 유지
   2. RESET 버튼을 한 번 누르고 떼기
   3. BOOT 버튼을 떼기
   4. 부트 모드 진입 완료
   ```

2. **USB 드라이버 확인**
   - ESP32-S3 USB 드라이버 설치
   - 장치 관리자에서 인식 확인
   - 다른 USB 포트 사용

3. **케이블 교체**
   - 데이터 전송 지원 USB-C 케이블 사용
   - 충전 전용 케이블 사용 금지

### 부팅 실패 (Bootloop)
#### 증상
- 계속 재부팅 반복
- 부팅 화면에서 멈춤
- 시리얼 모니터에서 오류 메시지

#### 해결 방법
1. **플래시 완전 지우기**
   ```bash
   esptool.py --chip esp32s3 erase_flash
   ```

2. **펌웨어 재설치**
   - 웹 업로드 도구로 완전 재설치
   - 모든 파티션 다시 플래시

## 📊 시스템 진단

### 로그 확인
시리얼 모니터(115200 baud)에서 로그 확인:

```
[INFO] TALLY NODE v1.2.0 시작
[INFO] WiFi 연결 시도...
[ERROR] ATEM 연결 실패: 타임아웃
[WARN] 배터리 전압 낮음: 3.4V
```

### 상태 확인 명령
웹 API를 통한 상태 확인:

```javascript
// 전체 상태 확인
fetch('/api/status').then(r => r.json()).then(console.log);

// 오류 로그 확인
fetch('/api/logs?level=error').then(r => r.json()).then(console.log);
```

### 메모리 사용량 확인
```
Free Heap: 234KB / 320KB (73%)
PSRAM: 1.8MB / 2MB (90%)
Flash: 3.2MB / 4MB (80%)
```

## 🆘 고급 문제 해결

### 완전 초기화 절차
모든 것이 실패할 때:

1. **하드웨어 리셋**
   - 전원 완전 차단 (배터리 + USB)
   - 30초 대기 후 재연결

2. **플래시 완전 지우기**
   ```bash
   esptool.py --port COM3 erase_flash
   ```

3. **펌웨어 새로 설치**
   - 웹 업로드 도구 사용
   - 최신 펌웨어 다운로드

4. **설정 초기화**
   - 팩토리 리셋 수행
   - 모든 설정 재입력

### 전문가 지원 요청 시 준비사항
- 시리얼 로그 전체 복사
- 사용 환경 정보 (스위처 모델, 네트워크 구성)
- 문제 발생 시점 및 재현 방법
- 펌웨어 버전 및 빌드 정보

---

문제가 지속된다면 [GitHub Issues](https://github.com/username/TALLY_NODE/issues)에 문의해주세요.